"use strict";(function(e){var t=e.livetime=e.livetime||{};t.version="0.0.1",t.localTimeOffset=null;var n=t.options=t.options||{};n.datetimeSelector="[datetime]",n.datetimeAttribute="datetime",n.dateLabelSelector="[data-time-label]",n.triggerRefreshComplete=!0,n.serverTimeUrl=null,n.formats=n.formats||{},n.formats.default=n.formats.default||[[-28512e3,"yyyy MMMM d at H:mm"],[-2592e3,"in td_M months d_d days, MMMM d at H:mm"],[-604800,"in td_d days, MMMM d at H:mm"],[-172800,"next eeee, MMMM d at H:mm"],[-7200,"in td_h hours d_m minutes, today at H:mm"],[-300,"in td_m minutes, at H:mm:ss"],[-60,"in td_m minutes d_s seconds, at H:mm:ss"],[0,"in td_s seconds, at H:mm:ss"],[60,"td_s seconds ago, at H:mm:ss"],[300,"td_m minutes d_s seconds ago, at H:mm:ss"],[7200,"td_m minutes ago, at H:mm:ss"],[172800,"td_h hours d_m minutes ago, today at H:mm"],[604800,"last eeee, MMMM d at H:mm"],[2592e3,"MMMM d at H:mm"],["yyyy MMMM d at H:mm"]],n.formats.seconds=n.formats.seconds||[[0,"in td_hh:d_mm:d_ss"],["td_hh:d_mm:d_ss ago"]],n.formats.milliseconds=n.formats.milliseconds||[[0,"in td_hh:d_mm:d_ss.d_fff"],["td_hh:d_mm:d_ss.d_fff ago"]],n.formats.humanized=n.formats.humanized||[[-31104e3,"MMMM d, yyyy"],[-518400,"MMMM d at h:mm tt"],[-172800,"eeee at h:mm tt"],[-86400,"Tomorrow at h:mm tt"],[-7200,"in td_h hours"],[-3600,"in about an hour"],[-120,"in td_m minutes"],[-60,"in about a minute"],[0,"in a few seconds"],[60,"a few seconds ago"],[120,"about a minute ago"],[3600,"td_m minutes ago"],[7200,"about an hour ago"],[86400,"td_h hours ago"],[172800,"Yesterday at h:mm tt"],[518400,"eeee at h:mm tt"],[31104e3,"MMMM d at h:mm tt"],["MMMM d, yyyy"]],n.formats.fulldate=n.formats.fulldate||"eee MMM d yyyy at h:mm:ss tt",n.formats.shortdate=n.formats.shortdate||"MMM d yyyy",n.formats.default_tooltip=n.formats.fulldate,n.formats.in=n.formats.in||[[0,"in"],[""]],n.formats.remaining=n.formats.remaining||[[0,"remaining"],[""]],n.formats.ago=n.formats.ago||[[0,""],["ago"]],n.formats.elapsed=n.formats.elapsed||[[0,""],["elapsed"]];var r=function(e,t){if(t<2)return e;var n=e+"";while(n.length<t)n="0"+n;return n},i={y:315576e5,M:2592e6,w:6048e5,d:864e5,e:864e5,h:36e5,m:6e4,s:1e3,f:1},s={M:"y",w:"M",d:"M",e:"w",h:"d",m:"h",s:"m",f:"s"},o={M:["January","February","March","April","May","June","July","August","September","October","November","December"],e:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},u=window.console&&typeof window.console.log=="function"?function(){console.call(console,arguments)}:function(){};t.now=function(){t.localTimeOffset===null&&t.getLocalTimeOffset();var e=t.localTimeOffset||0,n=new Date,r=n.getTime()-n.getTimezoneOffset()*60*1e3+e;return r},t.getLocalTimeOffset=function(){var r,i,s,o,a;if(!n.serverTimeUrl){t.localTimeOffset=0;return}if(!t.localTimeOffsetRequested&&(typeof t.localTimeOffset=="undefined"||t.localTimeOffset===null)){t.localTimeOffsetRequested=!0,t.localTimeOffset=0;var f=null;window.sessionStorage?f=window.sessionStorage.getItem("jlivetime-localtimeoffset"):f=/localtimeoffset=([0-9]+)[^0-9]?/i.exec(document.cookie)[1],typeof f!="undefined"&&f!==null?t.localTimeOffset=parseInt(f,10):e.ajax({url:n.serverTimeUrl,method:"jsonp",cache:!1,success:function(e,n,r){i=new Date,s=r.getResponseHeader("Date");var o=new Date(s);t.localTimeOffset=i.getTime()-o.getTime(),window.sessionStorage?window.sessionStorage.setItem("jlivetime-localtimeoffset",t.localTimeOffset):document.cookie="localtimeoffset="+t.localTimeOffset,t.localTimeOffset>1e4&&u("WARNING: local time offset is "+Math.round(t.localTimeOffset/1e3)+"s")}})}},t.millisecondsFromNow=function(e){var n=e;return e instanceof Date&&(n=e.getTime()+e.getTimezoneOffset()*60*1e3),t.now()-n},t.refresh=function(r){var i=(new Date).getTime(),s=e(r);s.addClass("jlivetime-active");var o=s.data("jlivetime-timeout");typeof o!="undefined"&&clearTimeout(o);var a=6e4,f=s.find(n.datetimeSelector);s.is(n.datetimeSelector)&&(f=f.add(s)),f.each(function(){var r=6e4,s=e(this),o=s.attr(n.datetimeAttribute);if(o){var f;try{if(o.indexOf("-")>0){var l=new Date(o);f=l.getTime()-l.getTimezoneOffset()*6e4}else f=parseInt(o,10)}catch(c){u("error parsing timestamp: "+c),f=0}if(f>0){var h=t.millisecondsFromNow(f);s.data("time-diff",h);var p=s.find(n.dateLabelSelector);s.is(n.dateLabelSelector)&&(p=p.add(s)),p.each(function(){var s=e(this),o=!1,u=!1,a=t.format(f,h,s.data("time-label")||"#default");a.value!==null&&typeof a.value!="undefined"&&s.html()!==a.value&&(s.html(a.value),o=!0),a.nextRefreshMs&&(r=Math.min(r,a.nextRefreshMs)),typeof s.data("time-tooltip")!="undefined"&&(a=t.format(f,h,s.data("time-tooltip")||"#default_tooltip"),a.value!==null&&typeof a.value!="undefined"&&s.attr("title")!==a.value&&(s.attr("title",a.value),typeof s.attr("data-original-title")!="undefined"&&s.attr("data-original-title",a.value),u=!0),a.nextRefreshMs&&(r=Math.min(r,a.nextRefreshMs))),(o||u)&&n.triggerRefreshComplete&&s.trigger("refreshComplete",{nextRefreshMs:r,htmlChanged:o,tooltipChanged:u,refreshElapsedTime:(new Date).getTime()-i})}),h<0&&(r=Math.min(r,-h)),a=Math.min(a,r)}}s.data("jlivetime-nextrefresh",(new Date).getTime()+a)}),a=Math.max(a,65),s.data("jlivetime-timeout",setTimeout(function(){t.refresh(r)},a))},t.disable=function(t){var n=e(t),r=n.data("jlivetime-timeout");typeof r!="undefined"&&clearTimeout(r),n.removeClass("jlivetime-active")},t.formatPart=function(e,t,n){if(n==="[]")return{value:""};var u=/^(t?d_)?(([yMdewHhmsft])\3*)$/.exec(n);if(u)if(!u[1]){var a=new Date(e+(new Date).getTimezoneOffset()*60*1e3);switch(u[3]){case"y":return{value:r(a.getYear()+1900,u[2].length)};case"M":var f=u[2].length>2?o.M[a.getMonth()]:r(a.getMonth()+1,u[2].length);return u[2].length===3&&(f=f.slice(0,3)),{value:f};case"w":return{value:r(Math.floor(a.getDate()/7)+1,u[2].length)};case"d":return{value:r(a.getDate(),u[2].length)};case"e":var l=u[2].length>1?o.e[a.getDay()]:a.getDay()+1;return u[2].length>1&&u[2].length<=3&&(l=l.slice(0,u[2].length)),{value:l};case"h":return{value:r(a.getHours()>12?a.getHours()-12:a.getHours(),u[2].length)};case"H":return{value:r(a.getHours(),u[2].length)};case"m":return{value:r(a.getMinutes(),u[2].length)};case"s":return{value:r(a.getSeconds(),u[2].length)};case"f":return{value:r(a.getMilliseconds(),u[2].length)};case"t":var c=a.getHours()>=12?"pm":"am";return{value:u[2].length>1?c:c.slice(0,1)}}}else{var h=i[u[3]];if(h){var p;p=Math.max(65,t>0?h-t%h:-t%h);if(u[1]=="td_")return{value:r(Math.floor(Math.abs(t/h)),u[2].length),nextRefreshMs:p};if(u[1]=="d_"){var d=i[s[u[3]]];return{value:r(Math.floor(Math.abs(d?t%d:t)/h),u[2].length),nextRefreshMs:p}}}}return{value:n}},t.format=function(e,r,i){var s=/\[?([a-z_]+)\]?/gim,o=[],u=6e4,a=0,f=i;if(i===null||i==="null")return{};if(typeof i=="string"&&i.slice(0,1)==="#"){f=n.formats[i.slice(1)];if(typeof f=="undefined")throw new Error("time format not found: "+i)}if(f instanceof Array){var l=f.length;for(var c=0;c<l;c++){if(f[c].length===1){f=f[c][0];break}if(f[c][0]*1e3>=r){u=Math.min(u,f[c][0]*1e3-r),f=f[c][1];break}}f instanceof Array&&(f="<unknown>")}if(f===null||f==="null")return{nextRefreshMs:u};var h=s.exec(f);while(h){o.push(f.slice(a,h.index));if(h[0].length!=h[1].length)o.push(h[1]);else{var p=t.formatPart(e,r,h[0]);o.push(p.value),p.nextRefreshMs&&(u=Math.min(u,p.nextRefreshMs))}a=h.index+h[0].length,h=s.exec(f)}return o.push(f.slice(a)),{value:o.join(""),nextRefreshMs:u}},e.fn.livetime=function(e){this.each(function(){e===!1?t.disable(this):t.refresh(this)})}})(jQuery);